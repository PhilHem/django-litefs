{"id":"django-litefs-71w","title":"Move Django configuration to pytest fixture","description":"Move Django setup from module import time to pytest fixture. Currently Django is configured at module import in tests/django_adapter/unit/__init__.py (lines 6-32), causing side effects and setup overhead for all tests.\n\nLocation: tests/django_adapter/unit/__init__.py (lines 6-32)\n\nImpact:\n- Django setup before any test runs (even tests that don't need it)\n- Side effects leak between test modules\n- If Django setup fails, ALL unit tests fail to import\n\nAction:\n1. Move Django setup code to tests/django_adapter/unit/conftest.py as session-scoped autouse fixture\n2. Empty tests/django_adapter/unit/__init__.py of all Django setup code\n3. Use settings.configure() within fixture with test-specific database\n\nVerification: pytest tests/django_adapter/unit/ -v passes with fixture-based setup","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:33:13.791123+01:00","updated_at":"2025-12-25T13:43:24.446714+01:00","closed_at":"2025-12-25T13:43:24.446714+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-8xq","title":"Architecture Review Actions (2025-12-25)","description":"Actions identified from 5-agent parallel architecture review. Covers test organization, code deduplication, and configuration improvements.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-25T13:35:45.635115+01:00","updated_at":"2025-12-25T13:35:45.635115+01:00"}
{"id":"django-litefs-8xq.1","title":"Delete stale tests/django/ directory","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:43:40.306366+01:00","updated_at":"2025-12-25T13:58:05.931753+01:00","closed_at":"2025-12-25T13:58:05.931755+01:00","dependencies":[{"issue_id":"django-litefs-8xq.1","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:40.309693+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.2","title":"Move Django configuration to pytest fixture","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:43:41.523396+01:00","updated_at":"2025-12-25T13:58:08.534347+01:00","closed_at":"2025-12-25T13:58:08.534349+01:00","dependencies":[{"issue_id":"django-litefs-8xq.2","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:41.523751+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.3","title":"Create core integration test directory and move concurrency tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:43:42.679633+01:00","updated_at":"2025-12-25T13:58:10.221316+01:00","closed_at":"2025-12-25T13:58:10.221319+01:00","dependencies":[{"issue_id":"django-litefs-8xq.3","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:42.680094+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.4","title":"Extract SQL detection logic to core","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T13:43:43.716826+01:00","updated_at":"2025-12-25T13:43:43.716826+01:00","dependencies":[{"issue_id":"django-litefs-8xq.4","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:43.718602+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.5","title":"Consolidate mount path validation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T13:43:44.767548+01:00","updated_at":"2025-12-25T13:43:44.767548+01:00","dependencies":[{"issue_id":"django-litefs-8xq.5","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:44.769332+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.6","title":"Make transaction mode configurable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T13:43:45.974922+01:00","updated_at":"2025-12-25T13:43:45.974922+01:00","dependencies":[{"issue_id":"django-litefs-8xq.6","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:45.976442+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.7","title":"Add Django settings reset fixture","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-25T13:43:47.209291+01:00","updated_at":"2025-12-25T13:43:47.209291+01:00","dependencies":[{"issue_id":"django-litefs-8xq.7","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:47.210739+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.8","title":"Verify ports export in adapters __init__.py","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-25T13:43:48.469058+01:00","updated_at":"2025-12-25T13:43:48.469058+01:00","dependencies":[{"issue_id":"django-litefs-8xq.8","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:48.469549+01:00","created_by":"daemon"}]}
{"id":"django-litefs-8xq.9","title":"Document exception hierarchy intent","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-25T13:43:49.508998+01:00","updated_at":"2025-12-25T13:43:49.508998+01:00","dependencies":[{"issue_id":"django-litefs-8xq.9","depends_on_id":"django-litefs-8xq","type":"parent-child","created_at":"2025-12-25T13:43:49.509371+01:00","created_by":"daemon"}]}
{"id":"django-litefs-9md","title":"Verify ports export in adapters __init__.py","description":"Verify that PrimaryDetectorPort is properly exported from packages/litefs/src/litefs/adapters/__init__.py. Tests import from litefs.adapters.ports but export may be missing or incomplete.\n\nLocation: packages/litefs/src/litefs/adapters/__init__.py\n\nAction:\nVerify file contains proper exports:\n  from .ports import PrimaryDetectorPort\n  __all__ = ['PrimaryDetectorPort']\n\nAlso update to include sql_detection exports (from related medium-priority task):\n  from .sql_detection import is_write_operation, strip_sql_comments\n  __all__ = ['PrimaryDetectorPort', 'is_write_operation', 'strip_sql_comments']\n\nVerification: Imports work correctly: from litefs.adapters import PrimaryDetectorPort","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T13:33:43.244009+01:00","updated_at":"2025-12-25T13:43:25.230442+01:00","closed_at":"2025-12-25T13:43:25.230442+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-c3k","title":"Create core integration test directory and move concurrency tests","description":"Create tests/core/integration/ directory and move concurrency tests from tests/core/unit/usecases/test_primary_detector.py. Tests currently marked @pytest.mark.unit spawn threads with threading.Thread() and have filesystem race conditions, violating unit test requirements.\n\nLocation: tests/core/unit/usecases/test_primary_detector.py (lines 42-265)\n\nPer CLAUDE.md: 'Unit tests must NOT spawn subprocesses, access filesystem beyond temp dirs, or require FUSE/Docker.'\n\nAction:\n1. Create directory structure: tests/core/integration/usecases/\n2. Move concurrency tests to tests/core/integration/usecases/test_primary_detector_concurrency.py\n3. Update markers from @pytest.mark.unit to @pytest.mark.integration + @pytest.mark.concurrency\n4. Keep simple unit tests (lines 10-39) in original location\n\nVerification:\n- pytest -m unit runs fast (no threading tests)\n- pytest -m integration includes concurrency tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:33:16.159262+01:00","updated_at":"2025-12-25T13:43:24.57358+01:00","closed_at":"2025-12-25T13:43:24.57358+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-cuo","title":"Extract SQL detection logic to core","description":"Extract _is_write_operation() and _strip_sql_comments() from Django backend to core package. Currently duplicated between production code and tests, breaking DRY principle.\n\nLocations:\n- packages/litefs-django/src/litefs_django/db/backends/litefs/base.py (lines 69-144)\n- tests/django_adapter/unit/test_db_backend_concurrency.py (lines 43-109)\n\nAction:\n1. Create packages/litefs/src/litefs/adapters/sql_detection.py with:\n   - strip_sql_comments(sql: str) -\u003e str\n   - is_write_operation(sql: str) -\u003e bool\n   - Regex patterns for block/line comments and CTE write keywords\n\n2. Update packages/litefs/src/litefs/adapters/__init__.py to export:\n   - from .ports import PrimaryDetectorPort\n   - from .sql_detection import is_write_operation, strip_sql_comments\n\n3. Update Django backend to import from litefs.adapters.sql_detection\n\n4. Remove duplicated code from test_db_backend_concurrency.py\n\nVerification: Tests pass importing from litefs.adapters.sql_detection","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:33:26.892311+01:00","updated_at":"2025-12-25T13:43:24.704713+01:00","closed_at":"2025-12-25T13:43:24.704713+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-kos","title":"Document exception hierarchy intent","description":"Document why NotPrimaryError inherits from Django's DatabaseError. This is intentional for proper Django error handling but not documented.\n\nLocation: packages/litefs-django/src/litefs_django/exceptions.py\n\nProblem: Non-obvious inheritance choice may confuse future maintainers.\n\nAction:\nAdd docstring to NotPrimaryError explaining:\n- Inherits from django.db.DatabaseError intentionally\n- Enables proper Django error handling in transaction middleware\n- Supports debugging and exception propagation in Django context\n- Allows Django to treat as database-level error\n\nExample:\n'''\nRaised when a write operation is attempted on a replica node.\n\nInherits from django.db.DatabaseError intentionally for proper\nDjango error handling in transaction middleware, debugging, and\nexception propagation.\n'''\n\nVerification: Docstring present and clear","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T13:33:44.755285+01:00","updated_at":"2025-12-25T13:43:25.362412+01:00","closed_at":"2025-12-25T13:43:25.362412+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-obs","title":"Add Django settings reset fixture","description":"Add pytest fixture to reset Django state between tests. Currently if one test modifies Django settings or cache, it affects subsequent tests.\n\nLocation: tests/django_adapter/unit/conftest.py\n\nProblem: Test isolation - Django caches and settings can leak between tests.\n\nAction:\nAdd autouse fixture that:\n1. Clears Django cache after each test\n2. Resets any modified settings to original values\n3. Handles missing cache gracefully\n\nVerification: Tests pass with state isolation, no cross-test contamination","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T13:33:40.66954+01:00","updated_at":"2025-12-25T13:43:25.10222+01:00","closed_at":"2025-12-25T13:43:25.10222+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-rbo","title":"Delete stale tests/django/ directory","description":"Remove orphaned tests/django/ directory. Two parallel test hierarchies exist - tests/django/integration/ is stale while tests/django_adapter/ is active. The pytest.ini in litefs-django points to tests/django_adapter, making tests/django/ orphaned.\n\nAction:\n```bash\nrm -rf tests/django/\n```\n\nImpact:\n- Removes confusion about authoritative test location\n- Prevents new tests being added to wrong directory\n- Ensures CI only runs from active directory\n\nVerification: pytest --collect-only shows no tests from tests/django/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:33:12.292362+01:00","updated_at":"2025-12-25T13:43:24.317357+01:00","closed_at":"2025-12-25T13:43:24.317357+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-tmm","title":"Consolidate mount path validation","description":"Consolidate duplicate mount path existence validation. Currently checked twice per connection - in __init__ (line 239-245) and get_new_connection() (line 280-287).\n\nLocation: packages/litefs-django/src/litefs_django/db/backends/litefs/base.py\n\nProblem: Same validation performed redundantly.\n\nAction (Recommended):\nCreate LiteFSMountPath value object in packages/litefs/src/litefs/domain/mount_path.py:\n- Validates path exists on construction\n- Provides primary_file property for .primary file location\n- Use in both PrimaryDetector and DatabaseWrapper\n\nAlternative: Remove validation from __init__, keep only in get_new_connection() for fail-fast on actual connection.\n\nVerification: Single validation point, tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:33:28.093936+01:00","updated_at":"2025-12-25T13:43:24.839185+01:00","closed_at":"2025-12-25T13:43:24.839185+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
{"id":"django-litefs-xxn","title":"Make transaction mode configurable","description":"Make BEGIN IMMEDIATE transaction mode configurable. Currently hardcoded in base.py (lines 293-298), users cannot opt-out for specific transaction requirements.\n\nLocation: packages/litefs-django/src/litefs_django/db/backends/litefs/base.py\n\nAction:\n1. Add OPTIONS to Django database config:\n   DATABASES = {\n       'default': {\n           'ENGINE': 'litefs_django.db.backends.litefs',\n           'OPTIONS': {\n               'litefs_mount_path': '/var/lib/litefs',\n               'transaction_mode': 'IMMEDIATE',  # or 'DEFERRED' (default SQLite)\n           },\n       }\n   }\n\n2. Update get_new_connection() to read transaction_mode from settings_dict OPTIONS\n\n3. Apply mode at transaction level, not connection level (PRAGMA read_uncommitted, BEGIN mode)\n\nVerification: Tests pass with both IMMEDIATE and DEFERRED modes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:33:29.293182+01:00","updated_at":"2025-12-25T13:43:24.969508+01:00","closed_at":"2025-12-25T13:43:24.969508+01:00","close_reason":"Closed","labels":["architecture-review-2025"]}
