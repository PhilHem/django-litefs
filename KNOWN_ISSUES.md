# Known Issues

## Legend

- **ID**: `{PREFIX}-XXX` format (e.g., `AUTH-001`, `CACHE-002`)
- **Complexity**: `EASY` (< 30 min) | `MED` (30 min - 2 hours) | `HARD` (> 2 hours)
- **Status**: `unconfirmed` | `confirmed` | `fixed` | `wontfix`
- **Source**: `hex-analysis` | `property-test` | `concurrency-test` | `differential-test` | `unit-test` | `manual` | `roadmap-update` | `roadmap-migration` | `tech-debt`
- **Description**: Brief issue description
- **Location**: File path, function name, or component where issue occurs
- **Timestamp**: ISO 8601 format `YYYY-MM-DD`

## Unconfirmed Issues

| ID           | Complexity | Status      | Source        | Description                                                                                                                                                                                                                     | Location                                                           | Timestamp  |
| ------------ | ---------- | ----------- | ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | ---------- |
| CORE-003-PBT | EASY       | unconfirmed | arch-analysis | Missing property-based test for path sanitization (unit tests exist, but PBT would cover more edge cases).                                                                                                                      | `litefs/domain/settings.py`                                        | 2025-12-18 |
| CORE-004     | MED        | unconfirmed | arch-analysis | Config generation may produce invalid YAML for edge cases (empty strings, special chars, unicode). Missing property-based test for YAML validity.                                                                               | `litefs/usecases/config_generator.py`                              | 2025-12-18 |
| CORE-005     | MED        | unconfirmed | arch-analysis | Primary detection may return stale result if `.primary` file is deleted/created between check and read. No test for file system race conditions.                                                                                | `litefs/usecases/primary_detector.py`                              | 2025-12-18 |
| CORE-006     | EASY       | unconfirmed | arch-analysis | Settings normalization may not be idempotent (normalize(normalize(x)) != normalize(x)). Missing property-based test.                                                                                                            | `litefs/domain/settings.py`                                        | 2025-12-18 |
| CORE-007     | MED        | unconfirmed | arch-analysis | Config generation may fail silently or produce partial config if required settings are missing. Missing differential test against reference LiteFS config format.                                                               | `litefs/usecases/config_generator.py`                              | 2025-12-18 |
| CORE-008     | MED        | unconfirmed | arch-analysis | Primary detection may not handle concurrent writes to `.primary` file during leader election (V2 Raft). Missing probabilistic concurrency test.                                                                                 | `litefs/usecases/primary_detector.py`                              | 2025-12-18 |
| CORE-009     | EASY       | unconfirmed | arch-analysis | Settings may accept invalid port numbers (negative, >65535, non-integer). Missing property-based test for bounds validation.                                                                                                    | `litefs/domain/settings.py`                                        | 2025-12-18 |
| CORE-010     | MED        | unconfirmed | arch-analysis | Config generation may not preserve ordering of settings fields, causing diff noise. Missing differential test for deterministic output.                                                                                         | `litefs/usecases/config_generator.py`                              | 2025-12-18 |
| DJANGO-004   | MED        | unconfirmed | hex-analysis  | DB backend write operations on replica may not be caught if primary check result is stale (cached or checked before failover). Missing concurrency test for stale state.                                                        | `litefs_django/db/backends/litefs/base.py`                         | 2025-12-18 |
| DJANGO-005   | MED        | unconfirmed | hex-analysis  | DB backend connection initialization race if LiteFS not ready (mount path doesn't exist yet). Multiple threads may initialize connections simultaneously. Missing concurrency test.                                             | `litefs_django/db/backends/litefs/base.py`                         | 2025-12-18 |
| DJANGO-010   | MED        | unconfirmed | tech-debt     | [quality] [future] Simplistic write operation detection. `_is_write_operation` only checks start of SQL for keywords. Root cause: MVP priority. Remediation: Use robust SQL parsing.                                            | `litefs_django/db/backends/litefs/base.py`                         | 2025-12-18 |
| DJANGO-013   | MED        | unconfirmed | hex-analysis  | WAL mode setting contention: Multiple threads initializing connections simultaneously could all try to set `PRAGMA journal_mode=WAL`, causing contention. Missing concurrency test.                                             | `litefs_django/db/backends/litefs/base.py:get_new_connection`      | 2025-12-18 |

## Confirmed Issues

| ID         | Complexity | Status    | Source           | Description                                                                                                                                                                                   | Location                                                                          | Timestamp  |
| ---------- | ---------- | --------- | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | ---------- |
| DJANGO-011 | MED        | confirmed | tech-debt        | [testing] [blocking] Integration test infrastructure created with placeholder tests. Tests skip gracefully when Docker/FUSE not available. Full implementation requires Docker Compose setup. | `tests/django/integration/`                                                       | 2025-12-18 |
| DJANGO-012 | MED        | confirmed | concurrency-test | Shared PrimaryDetector instance across threads tested. Concurrent is_primary() calls during failover work correctly - file.exists() is atomic. No race condition found.                       | `litefs_django/db/backends/litefs/base.py`, `litefs/usecases/primary_detector.py` | 2025-12-18 |

## Resolved Issues

| ID         | Complexity | Status  | Source           | Description                                                                                                                                                                                                                                  | Location                                                                            | Timestamp  |
| ---------- | ---------- | ------- | ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ---------- |
| CORE-003   | EASY       | fixed   | unit-test        | Settings validation rejects path traversal attacks (e.g., `../../../etc/passwd`). Unit tests implemented.                                                                                                                                    | `litefs/domain/settings.py`                                                         | 2025-12-18 |
| DJANGO-001 | MED        | fixed   | property-test    | Settings reader round-trip conversion is idempotent. Property-based test implemented.                                                                                                                                                        | `litefs_django/settings.py`                                                         | 2025-12-18 |
| DJANGO-002 | EASY       | fixed   | unit-test        | Settings reader case sensitivity mapping (UPPER_CASE → snake_case) works correctly. Unit tests implemented.                                                                                                                                  | `litefs_django/settings.py`                                                         | 2025-12-18 |
| DJANGO-006 | MED        | fixed   | unit-test        | DB backend delegates to PrimaryDetector use case (Clean Architecture compliance). Architecture verified.                                                                                                                                     | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| DJANGO-007 | EASY       | fixed   | unit-test        | Settings reader handles missing/optional fields correctly (defaults to None). Unit tests implemented.                                                                                                                                        | `litefs_django/settings.py`                                                         | 2025-12-18 |
| DJANGO-008 | MED        | fixed   | unit-test        | Settings reader validation matches domain validation. Differential test implemented.                                                                                                                                                         | `litefs_django/settings.py`, `litefs/domain/settings.py`                            | 2025-12-18 |
| DJANGO-009 | MED        | fixed   | unit-test        | DB backend enforces IMMEDIATE transaction mode. Transaction mode set in get_new_connection.                                                                                                                                                  | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| DJANGO-015 | MED        | fixed   | concurrency-test | Concurrent thread access to database backend is safe. Combined probabilistic concurrency test confirms multiple threads can safely perform mixed operations (reads, writes, primary checks, connection initialization) simultaneously.       | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| DJANGO-016 | MED        | fixed   | concurrency-test | SQLite lock contention handled correctly with WAL mode and IMMEDIATE transactions. Probabilistic concurrency test confirms 20 concurrent threads can perform writes without "database is locked" errors.                                     | `litefs_django/db/backends/litefs/base.py:LiteFSCursor.execute`                     | 2025-12-18 |
| DJANGO-017 | MED        | fixed   | concurrency-test | Concurrent primary checks are thread-safe. Probabilistic concurrency test confirms PrimaryDetector.is_primary() handles concurrent calls safely during failover scenarios with no race conditions.                                           | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._check_primary_before_write` | 2025-12-18 |
| DJANGO-018 | MED        | fixed   | concurrency-test | Write operation detection is thread-safe. Probabilistic concurrency test confirms \_is_write_operation produces consistent results across 50 concurrent threads with no false positives or missed operations.                                | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._is_write_operation`         | 2025-12-18 |
| DJANGO-019 | MED        | fixed   | concurrency-test | Concurrent connection initialization is safe. Probabilistic concurrency test confirms 30 threads can initialize connections simultaneously with PRAGMA statements (WAL mode, IMMEDIATE transactions) without contention.                     | `litefs_django/db/backends/litefs/base.py:get_new_connection`                       | 2025-12-18 |
| DJANGO-014 | MED        | fixed   | unit-test        | IMMEDIATE transaction mode enforced in all transaction boundaries. Overrode `_start_transaction_under_autocommit` to execute `BEGIN IMMEDIATE` for all Django transactions (autocommit, @transaction.atomic, transaction.atomic()). | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper._start_transaction_under_autocommit` | 2025-12-18 |
| DJANGO-020 | MED        | fixed   | unit-test        | Django transaction start method overridden. `_start_transaction_under_autocommit` now executes `BEGIN IMMEDIATE` instead of default `BEGIN` (DEFERRED), ensuring all transactions use IMMEDIATE mode.                               | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper._start_transaction_under_autocommit` | 2025-12-18 |
| DJANGO-021 | MED        | fixed   | unit-test        | Verification added that all Django transaction boundaries use IMMEDIATE mode. Unit test verifies `BEGIN IMMEDIATE` is used in transaction start method.                                                                    | `litefs_django/db/backends/litefs/base.py`, `tests/django/unit/test_db_backend.py` | 2025-12-18 |
| DJANGO-022 | MED        | fixed   | concurrency-test | Connection reuse enforces IMMEDIATE mode. Concurrency test confirms that when connections are reused across transaction boundaries, all transactions use `BEGIN IMMEDIATE` mode consistently.                                    | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper._start_transaction_under_autocommit` | 2025-12-18 |
| DJANGO-003 | HARD       | wontfix | hex-analysis     | DB backend race condition: Primary check → write operation gap (primary could change between check and write, allowing writes on replica). This is an architectural limitation of LiteFS's single-writer model. Documented in code comments. | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| CORE-001     | MED        | fixed   | property-test    | Config generation round-trip idempotence verified. Property-based test implemented confirming parse(generate(settings)) preserves all YAML-representable fields.                                                                  | `litefs/usecases/config_generator.py`, `litefs/usecases/config_parser.py`          | 2025-12-18 |
| CORE-011     | MED        | fixed   | unit-test        | Config generation includes `proxy.addr` field in YAML. Unit tests verify proxy_addr setting is preserved in generated config.                                                                                                    | `litefs/usecases/config_generator.py`                                               | 2025-12-18 |
| CORE-012     | MED        | fixed   | unit-test        | ConfigParser use case implemented to convert LiteFS YAML config back to LiteFSSettings. Round-trip functionality enabled with proper error handling.                                                                            | `litefs/usecases/config_parser.py`                                                  | 2025-12-18 |
| CORE-002     | MED        | fixed   | concurrency-test | Primary detection two-step check race condition does not exist. Probabilistic concurrency test confirms that if mount_path disappears between checks, `primary_file.exists()` returns False (no exception), maintaining consistent behavior. | `litefs/usecases/primary_detector.py:is_primary()`                 | 2025-12-18 |
| CORE-013     | MED        | fixed   | concurrency-test | Symlink staleness issue does not exist. Probabilistic concurrency test confirms Path operations resolve symlinks automatically on each call, so detector correctly uses updated symlink targets without caching stale paths.        | `litefs/usecases/primary_detector.py:__init__()`                   | 2025-12-18 |
| CORE-014     | MED        | fixed   | concurrency-test | Exception type consistency verified. Probabilistic concurrency test confirms all exceptions during concurrent mount_path deletion are consistently LiteFSNotRunningError (no OSError or other types), regardless of deletion timing. | `litefs/usecases/primary_detector.py:is_primary()`                 | 2025-12-18 |
