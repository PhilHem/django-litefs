# Known Issues

## Legend

- **ID**: `{PREFIX}-XXX` format (e.g., `AUTH-001`, `CACHE-002`)
- **Complexity**: `EASY` (< 30 min) | `MED` (30 min - 2 hours) | `HARD` (> 2 hours)
- **Status**: `unconfirmed` | `confirmed` | `fixed` | `wontfix`
- **Source**: `hex-analysis` | `property-test` | `concurrency-test` | `differential-test` | `unit-test` | `manual` | `roadmap-update` | `roadmap-migration` | `tech-debt`
- **Description**: Brief issue description
- **Location**: File path, function name, or component where issue occurs
- **Timestamp**: ISO 8601 format `YYYY-MM-DD`

## Unconfirmed Issues

| ID         | Complexity | Status      | Source    | Description                                                                                                                                                                   | Location                                   | Timestamp  |
| ---------- | ---------- | ----------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------ | ---------- |

## Confirmed Issues

| ID         | Complexity | Status    | Source           | Description                                                                                                                                                                                   | Location                                                                          | Timestamp  |
| ---------- | ---------- | --------- | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | ---------- |
| DJANGO-011 | MED        | confirmed | tech-debt        | [testing] [blocking] Integration test infrastructure created with placeholder tests. Tests skip gracefully when Docker/FUSE not available. Full implementation requires Docker Compose setup. | `tests/django/integration/`                                                       | 2025-12-18 |

## Resolved Issues

| ID         | Complexity | Status  | Source           | Description                                                                                                                                                                                                                                  | Location                                                                            | Timestamp  |
| ---------- | ---------- | ------- | ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ---------- |
| CORE-003   | EASY       | fixed   | unit-test        | Settings validation rejects path traversal attacks (e.g., `../../../etc/passwd`). Unit tests implemented.                                                                                                                                    | `litefs/domain/settings.py`                                                         | 2025-12-18 |
| DJANGO-001 | MED        | fixed   | property-test    | Settings reader round-trip conversion is idempotent. Property-based test implemented.                                                                                                                                                        | `litefs_django/settings.py`                                                         | 2025-12-18 |
| DJANGO-002 | EASY       | fixed   | unit-test        | Settings reader case sensitivity mapping (UPPER_CASE → snake_case) works correctly. Unit tests implemented.                                                                                                                                  | `litefs_django/settings.py`                                                         | 2025-12-18 |
| DJANGO-006 | MED        | fixed   | unit-test        | DB backend delegates to PrimaryDetector use case (Clean Architecture compliance). Architecture verified.                                                                                                                                     | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| DJANGO-007 | EASY       | fixed   | unit-test        | Settings reader handles missing/optional fields correctly (defaults to None). Unit tests implemented.                                                                                                                                        | `litefs_django/settings.py`                                                         | 2025-12-18 |
| DJANGO-008 | MED        | fixed   | unit-test        | Settings reader validation matches domain validation. Differential test implemented.                                                                                                                                                         | `litefs_django/settings.py`, `litefs/domain/settings.py`                            | 2025-12-18 |
| DJANGO-009 | MED        | fixed   | unit-test        | DB backend enforces IMMEDIATE transaction mode. Transaction mode set in get_new_connection.                                                                                                                                                  | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| DJANGO-015 | MED        | fixed   | concurrency-test | Concurrent thread access to database backend is safe. Combined probabilistic concurrency test confirms multiple threads can safely perform mixed operations (reads, writes, primary checks, connection initialization) simultaneously.       | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| DJANGO-016 | MED        | fixed   | concurrency-test | SQLite lock contention handled correctly with WAL mode and IMMEDIATE transactions. Probabilistic concurrency test confirms 20 concurrent threads can perform writes without "database is locked" errors.                                     | `litefs_django/db/backends/litefs/base.py:LiteFSCursor.execute`                     | 2025-12-18 |
| DJANGO-017 | MED        | fixed   | concurrency-test | Concurrent primary checks are thread-safe. Probabilistic concurrency test confirms PrimaryDetector.is_primary() handles concurrent calls safely during failover scenarios with no race conditions.                                           | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._check_primary_before_write` | 2025-12-18 |
| DJANGO-018 | MED        | fixed   | concurrency-test | Write operation detection is thread-safe. Probabilistic concurrency test confirms \_is_write_operation produces consistent results across 50 concurrent threads with no false positives or missed operations.                                | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._is_write_operation`         | 2025-12-18 |
| DJANGO-019 | MED        | fixed   | concurrency-test | Concurrent connection initialization is safe. Probabilistic concurrency test confirms 30 threads can initialize connections simultaneously with PRAGMA statements (WAL mode, IMMEDIATE transactions) without contention.                     | `litefs_django/db/backends/litefs/base.py:get_new_connection`                       | 2025-12-18 |
| DJANGO-014 | MED        | fixed   | unit-test        | IMMEDIATE transaction mode enforced in all transaction boundaries. Overrode `_start_transaction_under_autocommit` to execute `BEGIN IMMEDIATE` for all Django transactions (autocommit, @transaction.atomic, transaction.atomic()). | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper._start_transaction_under_autocommit` | 2025-12-18 |
| DJANGO-020 | MED        | fixed   | unit-test        | Django transaction start method overridden. `_start_transaction_under_autocommit` now executes `BEGIN IMMEDIATE` instead of default `BEGIN` (DEFERRED), ensuring all transactions use IMMEDIATE mode.                               | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper._start_transaction_under_autocommit` | 2025-12-18 |
| DJANGO-021 | MED        | fixed   | unit-test        | Verification added that all Django transaction boundaries use IMMEDIATE mode. Unit test verifies `BEGIN IMMEDIATE` is used in transaction start method.                                                                    | `litefs_django/db/backends/litefs/base.py`, `tests/django/unit/test_db_backend.py` | 2025-12-18 |
| DJANGO-022 | MED        | fixed   | concurrency-test | Connection reuse enforces IMMEDIATE mode. Concurrency test confirms that when connections are reused across transaction boundaries, all transactions use `BEGIN IMMEDIATE` mode consistently.                                    | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper._start_transaction_under_autocommit` | 2025-12-18 |
| DJANGO-005 | MED        | fixed   | concurrency-test | DB backend connection initialization race if LiteFS not ready fixed. Added mount_path validation in get_new_connection() that raises LiteFSNotRunningError consistently. Probabilistic concurrency test confirms all threads get consistent error type. | `litefs_django/db/backends/litefs/base.py:get_new_connection`                       | 2025-12-18 |
| DJANGO-024 | MED        | fixed   | concurrency-test | Race condition when mount_path appears during concurrent connection attempts fixed. Added mount_path validation in get_new_connection() that handles mount_path appearance gracefully. Probabilistic concurrency test confirms no database file creation races. | `litefs_django/db/backends/litefs/base.py:get_new_connection`                       | 2025-12-18 |
| DJANGO-025 | MED        | fixed   | concurrency-test | Error handling for missing mount_path in get_new_connection fixed. Added mount_path validation that raises clear LiteFSNotRunningError when mount_path doesn't exist, providing graceful error handling instead of generic SQLite errors. | `litefs_django/db/backends/litefs/base.py:get_new_connection`                       | 2025-12-18 |
| DJANGO-026 | MED        | fixed   | concurrency-test | Error type consistency when mount_path missing fixed. Added mount_path validation in get_new_connection() that raises LiteFSNotRunningError consistently. Probabilistic concurrency test confirms all threads get same error type, making error handling predictable. | `litefs_django/db/backends/litefs/base.py:get_new_connection`                       | 2025-12-18 |
| DJANGO-027 | MED        | fixed   | unit-test        | PrimaryDetector creation validates mount_path exists (fail-fast) fixed. Added mount_path validation in __init__() that raises LiteFSNotRunningError immediately when mount_path doesn't exist, ensuring fail-fast behavior before PrimaryDetector creation. | `litefs_django/db/backends/litefs/base.py:DatabaseWrapper.__init__`                | 2025-12-18 |
| DJANGO-003 | HARD       | wontfix | hex-analysis     | DB backend race condition: Primary check → write operation gap (primary could change between check and write, allowing writes on replica). This is an architectural limitation of LiteFS's single-writer model. Documented in code comments. | `litefs_django/db/backends/litefs/base.py`                                          | 2025-12-18 |
| CORE-001     | MED        | fixed   | property-test    | Config generation round-trip idempotence verified. Property-based test implemented confirming parse(generate(settings)) preserves all YAML-representable fields.                                                                  | `litefs/usecases/config_generator.py`, `litefs/usecases/config_parser.py`          | 2025-12-18 |
| CORE-011     | MED        | fixed   | unit-test        | Config generation includes `proxy.addr` field in YAML. Unit tests verify proxy_addr setting is preserved in generated config.                                                                                                    | `litefs/usecases/config_generator.py`                                               | 2025-12-18 |
| CORE-012     | MED        | fixed   | unit-test        | ConfigParser use case implemented to convert LiteFS YAML config back to LiteFSSettings. Round-trip functionality enabled with proper error handling.                                                                            | `litefs/usecases/config_parser.py`                                                  | 2025-12-18 |
| CORE-002     | MED        | fixed   | concurrency-test | Primary detection two-step check race condition does not exist. Probabilistic concurrency test confirms that if mount_path disappears between checks, `primary_file.exists()` returns False (no exception), maintaining consistent behavior. | `litefs/usecases/primary_detector.py:is_primary()`                 | 2025-12-18 |
| CORE-013     | MED        | fixed   | concurrency-test | Symlink staleness issue does not exist. Probabilistic concurrency test confirms Path operations resolve symlinks automatically on each call, so detector correctly uses updated symlink targets without caching stale paths.        | `litefs/usecases/primary_detector.py:__init__()`                   | 2025-12-18 |
| CORE-014     | MED        | fixed   | concurrency-test | Exception type consistency verified. Probabilistic concurrency test confirms all exceptions during concurrent mount_path deletion are consistently LiteFSNotRunningError (no OSError or other types), regardless of deletion timing. | `litefs/usecases/primary_detector.py:is_primary()`                 | 2025-12-18 |
| CORE-005     | MED        | wontfix | arch-analysis    | TOCTOU: `is_primary()` result may be stale by caller action time. Architectural limitation - callers must handle ReplicaWriteError. Basic file race covered by CORE-002.                                                        | `packages/litefs/src/litefs/usecases/primary_detector.py:is_primary` | 2025-12-18 |
| CORE-008     | MED        | wontfix | arch-analysis    | Duplicate of CORE-002. Primary detection concurrent writes to `.primary` already tested and verified safe via `file.exists()` atomicity.                                                                                         | `packages/litefs/src/litefs/usecases/primary_detector.py`            | 2025-12-18 |
| CORE-003-PBT | EASY       | fixed  | property-test    | Path sanitization PBT implemented. Null byte injection bug found and fixed - validation now rejects paths containing null bytes. Unicode paths validated correctly.                                                                 | `packages/litefs/src/litefs/domain/settings.py:_validate_paths`      | 2025-12-18 |
| CORE-004     | MED        | fixed  | property-test    | YAML generation PBT implemented. Verified that `yaml.dump()` handles all edge cases correctly (special chars, multi-line, empty strings, unicode) - no bugs found.                                                              | `packages/litefs/src/litefs/usecases/config_generator.py:generate`   | 2025-12-18 |
| CORE-006     | EASY       | wontfix | arch-analysis    | No normalization methods exist in `LiteFSSettings` - nothing to test. Settings is a dataclass with no normalization logic.                                                                                                        | `packages/litefs/src/litefs/domain/settings.py`                      | 2025-12-18 |
| CORE-007     | MED        | wontfix | arch-analysis    | `ConfigGenerator.generate()` takes validated `LiteFSSettings` instance - cannot have missing required fields. Input validation ensures all fields present.                                                                      | `packages/litefs/src/litefs/usecases/config_generator.py`           | 2025-12-18 |
| CORE-009     | EASY       | wontfix | arch-analysis    | `proxy_addr` is a socket address string format (`:8080`, `localhost:3000`), not a port number. No port validation needed - format validation handled by LiteFS itself.                                                           | `packages/litefs/src/litefs/domain/settings.py`                     | 2025-12-18 |
| CORE-010     | MED        | fixed  | unit-test        | Config output determinism verified. Test confirms same settings produce byte-identical YAML output. Python 3.7+ dict ordering ensures deterministic output.                                                                     | `packages/litefs/src/litefs/usecases/config_generator.py:generate`   | 2025-12-18 |
| INTEG-001    | MED        | fixed   | unit-test        | `litefs_available` fixture now uses `subprocess.run()` instead of `os.system()` for thread-safe Docker detection. Prevents flaky detection in parallel test collection (pytest-xdist).                                                                           | `tests/django/integration/conftest.py:litefs_available`            | 2025-12-18 |
| INTEG-002    | MED        | fixed   | unit-test        | FUSE detection now supports cross-platform paths. macOS checks `/dev/osxfuse` and `/dev/macfuse`. Linux checks `/dev/fuse`. Non-POSIX fallback returns True. Helper function `_check_fuse_available()` extracted for clarity.                                                 | `tests/django/integration/conftest.py:_check_fuse_available`            | 2025-12-18 |
| INTEG-004    | EASY       | fixed   | unit-test        | Double-skip pattern removed. Integration tests no longer call `pytest.skip()` internally. Tests rely solely on `skip_if_no_litefs` fixture for skipping when infrastructure unavailable.                                                                         | `tests/django/integration/test_db_backend_integration.py`          | 2025-12-18 |
| INTEG-003    | HARD       | wontfix | hex-analysis     | No multi-node cluster integration tests. Placeholder tests only verify single-node scenarios. Actual replication, failover, and split-brain scenarios require 2+ node Docker Compose setup. Out of scope - requires Docker Compose infrastructure setup.                                      | `tests/django/integration/test_db_backend_integration.py`          | 2025-12-18 |
| DJANGO-013   | MED        | fixed   | concurrency-test | WAL mode setting contention tested. DJANGO-019 confirms 30 concurrent threads can initialize connections with PRAGMA journal_mode=WAL without contention.                                                                       | `litefs_django/db/backends/litefs/base.py:get_new_connection`      | 2025-12-18 |
| DJANGO-004   | MED        | fixed   | concurrency-test | TOCTOU gap behavior documented and tested. Test verifies behavior when failover occurs between is_primary() check and execute(). Related to DJANGO-003 (wontfix architectural limit).                                           | `litefs_django/db/backends/litefs/base.py:LiteFSCursor.execute`    | 2025-12-18 |
| DJANGO-023   | MED        | fixed   | concurrency-test | Error type tests implemented. Documents sqlite3.OperationalError propagation when TOCTOU gap allows write to reach SQLite on replica.                                                                                           | `litefs_django/db/backends/litefs/base.py:LiteFSCursor.execute`    | 2025-12-18 |
| DJANGO-012   | MED        | fixed   | concurrency-test | Shared PrimaryDetector instance across threads tested. Concurrent is_primary() calls during failover work correctly - file.exists() is atomic. No race condition found.                                                         | `litefs_django/db/backends/litefs/base.py`, `litefs/usecases/primary_detector.py` | 2025-12-18 |
| DJANGO-010   | MED        | fixed   | unit-test        | Write detection now handles CTE patterns, maintenance operations (VACUUM/REINDEX/ANALYZE), and SQL with leading comments. Enhanced `_is_write_operation()` with comment stripping and CTE keyword detection.                    | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._is_write_operation`       | 2025-12-18 |
| DJANGO-028   | MED        | fixed   | unit-test        | `executescript()` now overridden to check primary status before execution. Scripts may contain write operations, so primary check is mandatory. Raises NotPrimaryError on replica nodes.                                         | `litefs_django/db/backends/litefs/base.py:LiteFSCursor.executescript`             | 2025-12-18 |
| DJANGO-029   | MED        | fixed   | unit-test        | CTE (Common Table Expression) write patterns now detected. `WITH ... INSERT/UPDATE/DELETE` statements correctly identified as write operations via keyword scanning after WITH clause.                                           | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._is_write_operation`       | 2025-12-18 |
| DJANGO-030   | MED        | fixed   | unit-test        | Database maintenance operations (VACUUM, REINDEX, ANALYZE) now detected as write operations. These modify database state and require primary node access.                                                                        | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._is_write_operation`       | 2025-12-18 |
| DJANGO-031   | MED        | fixed   | unit-test        | SQL comment stripping implemented for write detection. Block comments (`/* ... */`) and line comments (`-- ...`) are removed before keyword detection, preventing bypass via comment-prefixed statements.                        | `litefs_django/db/backends/litefs/base.py:LiteFSCursor._strip_sql_comments`       | 2025-12-18 |
| DJANGO-032   | MED        | wontfix | unit-test        | PrimaryDetector lifecycle confirmed safe. Detector instance shared across cursor operations remains valid - Path.exists() is atomic and stateless. No stale state issues found.                                                  | `litefs_django/db/backends/litefs/base.py:LiteFSCursor`                           | 2025-12-18 |
